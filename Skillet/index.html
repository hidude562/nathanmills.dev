<!DOCTYPE html>
<link rel="stylesheet" href="../style.css">

<html lang="en">
<head>
	<title>nathanmills.dev - Skillet</title>
	<link rel="icon" href="../icon.png">
	<!-- Include -->
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
	
	<object type="text/html" data="../banner.html" width=100% style="height: 200px"></object>
</head>
<body>

<div class="main_layer">
<div class="nav">
	<!-- Include the nav table -->
	<object type="text/html" data="../nav.html" height=100%></object>
</div>

<div class="page_dis">
<h1>Skillet</h1>

<p>Recipes generated by AI apparently ?? You can input the name of any dish, and optionally, a short description and it'll give you a recipe. For legal reasons, you shouldn't eat anything from here and there's only probably a 30% chance of a recipe making any sense. If you actually make the meal, please send me a photo and I will probably publish it on this page.</p>

<p>This uses the medium model of my finetuned gpt-2 on food.com recipes, I find it to be the best combination of speed and accuracy but if you would like to use the large model, you can view it <a href="https://huggingface.co/hidude562/Walter-L">here</a> (its currently a work in progress)</p>
<br>
<label for="title"><b>Recipe title (required):&nbsp </b></label><input type="text" id="title" name="title" placeholder="banana icecream"><br><br>

<p>Recipe description (Leave blank for automatic generation)</p>
<textarea type="text" rows="10" cols="70" id="description"></textarea>
<br>
<button onclick="generate();">Generate!</button>

<script>

function combineQuery(title, description) {
  if(description == "") {
		return title + "`";
	} else {
		return title + "`" + description + "`";
	}
}

var title = "Steamed hotdog hamburger"; // SET THIS TO THE VALUE OF THE TEXT BOX
var description = ""; 
var API_KEY = "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"; // API key for nathanmills.dev
var largeModel;

async function query(data) {
	const response = await fetch(
		"https://api-inference.huggingface.co/models/hidude562/Walter" + largeModel,
		{
			headers: { Authorization: "Bearer " + API_KEY},
			method: "POST",
			body: JSON.stringify(data),
		}
	);
	const result = await response.json();
	if(result.error != undefined) {
		alert('You got an error from Huggingface! "' + result.error + '"')
	}
	return result;
}


function generate() {
		title = (document.getElementById("title").value).toLowerCase();
		description = (document.getElementById("description").value).toLowerCase();
    query({"inputs": combineQuery(title, description),
           "parameters": {"max_new_tokens": 250}

          }).then((response) => {
        text = (response[0].generated_text);
		query({"inputs": text,
           "parameters": {"max_new_tokens": 250}

          }).then((response) => {
        text = (response[0].generated_text);
		
		
        text = text.split("`");
        console.log(text);
		document.getElementById("dishRec").innerHTML = "";
		
		recipe = text[2].slice(1,text[2].length - 2)
        recipe = recipe.split("',")
        for(var i = 0; i < recipe.length; i++) {
        	const node = document.createElement("li");
			recipe[i] = recipe[i].slice(1)
			if(recipe[i][0] == "'"){recipe[i] = recipe[i].slice(1);}
            const textnode = document.createTextNode(recipe[i][0].toUpperCase() + recipe[i].slice(1));
            node.appendChild(textnode);
            document.getElementById("dishRec").appendChild(node);
        }
        document.getElementById("dishTitle").innerHTML = text[0];
        document.getElementById("dishDisc").innerHTML  = text[1];
		});
    });
}
</script>


<br><br>
<hr>

<h1 id="dishTitle" style="text-transform: capitalize;"></h1>

<p id="dishDisc"></p>

<p><b>Steps:</b></p>
<ol id="dishRec"></ol>


</div>
</div>

<object type="text/html" data="../footer.html" width=100%></object>
</body>
</html>